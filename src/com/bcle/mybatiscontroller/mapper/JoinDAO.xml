<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.bcle.mybatiscontroller.IJoinDAO">
<!-- 인터페이스 있어야  -->
	
	<insert id="clubmemInsert">
		INSERT INTO CLUBMEMBERLIST(CLUBMEM_ID, POSITION_ID, JOIN_ID, BDATE) VALUES ('CM'||CLUBMEMBERLISTSEQ.NEXTVAL, '1', #{joinId}, SYSDATE)
	</insert>
	
	<insert id="joinClubReturnInsert">
		INSERT INTO JOIN_CLUB_RETURN(RETURN_ID, JOIN_ID, REASON_ID, BDATE) VALUES (JOIN_CLUB_RETURNSEQ.NEXTVAL, #{joinId}, '1', SYSDATE)
	</insert>
	
	<select id="cntMaxClubMem" resultType="java.lang.Integer">
		SELECT DISTINCT MAX
		FROM CLUBVIEW
		WHERE BDATE IS NOT NULL AND CLUBMEM_ID IS NOT NULL
		AND CLUBMEM_ID NOT IN (SELECT CLUBMEM_ID FROM BAN_MEM_LIST)
		AND CLUBMEM_ID NOT IN (SELECT CLUBMEM_ID FROM DROP_CLUB)
		AND CID NOT IN (SELECT CID FROM CLUBSTATUS WHERE STATUS_ID IN ('3', '4')) AND CID = #{cid}
	</select>
	
	<select id="cntClubMem" resultType="java.lang.Integer">
		SELECT DISTINCT (SELECT COUNT(*) FROM CLUBVIEW
		WHERE BDATE IS NOT NULL AND CLUBMEM_ID IS NOT NULL
		AND CLUBMEM_ID NOT IN (SELECT CLUBMEM_ID FROM BAN_MEM_LIST)
		AND CLUBMEM_ID NOT IN (SELECT CLUBMEM_ID FROM DROP_CLUB)
		AND CID NOT IN (SELECT CID FROM CLUBSTATUS WHERE STATUS_ID IN ('3', '4')) AND CID = #{cid}) AS CNT
		FROM CLUBVIEW
		WHERE BDATE IS NOT NULL AND CLUBMEM_ID IS NOT NULL
		AND CLUBMEM_ID NOT IN (SELECT CLUBMEM_ID FROM BAN_MEM_LIST)
		AND CLUBMEM_ID NOT IN (SELECT CLUBMEM_ID FROM DROP_CLUB)
		AND CID NOT IN (SELECT CID FROM CLUBSTATUS WHERE STATUS_ID IN ('3', '4')) AND CID = #{cid}
	</select>
	
</mapper>